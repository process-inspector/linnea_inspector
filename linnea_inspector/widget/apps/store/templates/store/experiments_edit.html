{% extends 'store/base.html' %}
{% import 'tvst-macros/datatables.html' as dt_macros %}
{% import 'tvst-macros/dataframes.html' as df_macros %}

    
{% block content %}
    <div class="container-fluid py-4">
        <div class="d-flex justify-content-between">
            <div>
                <h4>Delete Experiments</h4>
            </div>
            <div>
                <a href="{{ url_for('store.experiments') }}" class="btn btn-secondary btn-sm">
                    Back
                </a>
            </div>
        </div>
        {% call dt_macros.render_dt_with_selections(
            table_id='runs_table_delete',
            table_class='tvst-table display',
            page_length=5,
        ) %}
            {{ df_macros.render_df_with_selections(col_schema, records, pk, round=2) }}
        {% endcall %}
        <div class="d-flex justify-content-center mt-3">
            <button id="delete-selected-btn" class="btn btn-danger btn-sm">Delete Selections</button>
        </div>
    </div>

    <script>
        // on delete button click, get vals of input with id 'runs_table_delete_selections
        document.getElementById('delete-selected-btn').addEventListener('click', function() {
            const selectionsInput = document.getElementById('runs_table_delete-selections');
            const selectedIds = selectionsInput.value; // comma-separated string of selected primary keys

            // if selections is empty, alert and return
            if (!selectedIds) {
                alert('No experiments selected for deletion.');
                return;
            }

            // altert and send post request to delete endpoint
            if (confirm(`Are you sure you want to delete experiments with IDs: ${selectedIds}?`)) {
                fetch('{{ url_for("store.experiments_delete") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 'ids': selectedIds.split(',') })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Delete failed');
                    }
                    window.location.href = '{{ url_for("store.experiments") }}';
                })
                .catch(err => {
                    alert('Error deleting experiments');
                    console.error(err);
            });
            }
        });
    </script>
{% endblock content %}



    
    